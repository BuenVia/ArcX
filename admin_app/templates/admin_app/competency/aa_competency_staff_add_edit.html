{% extends 'admin_app/base.html' %}

{% block content %}

{% load static %}
<div id="roles-container">
    {% for form in role_formset %}
        <div class="role-form">
            {{ form.as_p }}
            <button type="button" class="remove-role">Remove</button>
        </div>
    {% endfor %}
</div>
<button type="button" id="add-role">Add Role</button>

<template id="role-template">
    <div class="role-form">
        {{ role_formset.empty_form.as_p }}
        <button type="button" class="remove-role">Remove</button>
    </div>
</template>

<script>

    document.addEventListener('DOMContentLoaded', () => {
        const rolesContainer = document.getElementById('roles-container');
        const addRoleButton = document.getElementById('add-role');
        const roleTemplate = document.getElementById('role-template').content;
    
        addRoleButton.addEventListener('click', () => {
            const newRole = document.importNode(roleTemplate, true);
            rolesContainer.appendChild(newRole);
            updateFormsetPrefix();
        });
    
        rolesContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-role')) {
                event.target.closest('.role-form').remove();
                updateFormsetPrefix();
            }
        });
    
        function updateFormsetPrefix() {
            const roleForms = rolesContainer.querySelectorAll('.role-form');
            roleForms.forEach((form, index) => {
                form.querySelectorAll('[name]').forEach(input => {
                    input.name = input.name.replace(/-\d+-/, `-${index}-`);
                    input.id = input.id.replace(/-\d+-/, `-${index}-`);
                });
            });
        }
    });

</script>


{% endblock %}
